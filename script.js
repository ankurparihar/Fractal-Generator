const rows=400,cols=400,canvas=document.getElementById("fractal_canvas"),ifs_head_div=document.getElementById("frctl_view_lines"),frctl_rule_count=document.getElementById("frctl_rule_count"),frctl_select=document.querySelector(".fractal_select select"),frctl_bottom_div=document.getElementsByClassName("frctl_bottom_div")[0];var i,p,clientX,clientY,ifs_c,ifs_r,tot_c,tot_r,context=canvas.getContext("2d"),imgData=context.createImageData(rows,cols),iterations=8;const ifsList={r:0,s:1,t:2,p:3,e:4,f:5},frctl_itr_count=document.getElementById("frctl_itr_count"),resetCanvasLayer=context.createImageData(rows,cols);fill(resetCanvasLayer,0,0,0,0);const IFSDB={0:{name:"Tree",param:["0.05","0.6","0","0","0.48","0.04","0.05","-0.6","0","0","0.47","0.5","0.5","0.45","45","45","0.3","0.08","0.5","0.4","20","20","0.28","0.5","0.5","0.5","-30","-30","0.3","0.65","0.55","0.4","-40","-40","0.32","0.4"]},1:{name:"Sierpinski Gasket",param:["0.5","0.5","0","0","0","0","0.5","0.5","0","0","0.5","0","0.5","0.5","0","0","0.25","0.5"]},2:{name:"Cantor Set",param:["0.33","1","0","0","0","0","0.33","1","0","0","0.67","0"]},3:{name:"Cantor Dust",param:["0.25","0.25","0","0","0","0","0.25","0.25","0","0","0.75","0","0.25","0.25","0","0","0","0.75","0.25","0.25","0","0","0.75","0.75"]},4:{name:"Vicsek fractal",param:["0.33","0.33","0","0","0","0","0.33","0.33","0","0","0.67","0","0.33","0.33","0","0","0","0.67","0.33","0.33","0","0","0.33","0.33","0.33","0.33","0","0","0.67","0.67"]},5:{name:"Hexaflake",param:["0.33","0.33","0","0","0","0.16","0.33","0.33","0","0","0","0.5","0.33","0.33","0","0","0.34","0","0.33","0.33","0","0","0.34","0.67","0.33","0.33","0","0","0.67","0.16","0.33","0.33","0","0","0.67","0.5"]},6:{name:"UnNamed (Assign 2-4)",param:["0.5","0.5","0","0","0","0","0.5","0.5","180","0","1","0","0.5","0.5","180","0","0.5","0.5"]}};var transImg,whiteImg,oprtnImg,tranCImg,IFSMatrix=["0.5","0.5","0","0","0","0","0.5","0.5","0","0","0.5","0","0.5","0.5","0","0","0.25","0.5"];function getIFSCord(t){clientX=t.getBoundingClientRect().x,clientY=t.getBoundingClientRect().y}function getIFSRule(t,a){ifs_c=t,ifs_r=a,showPopUp()}function changeIteration(){var t=parseInt(prompt("Please enter no of iterations","A +ve int"),10);Number.isInteger(t)&&t>0&&(iterations=t,frctl_itr_count.innerHTML="Iterations: 0/"+t,resetCanvas())}function showPopUp(){var t=document.getElementById("frctl_popup");t.style.left=clientX+"px",t.style.top=clientY+"px",t.classList.remove("frctl_hidden"),t.querySelector("#frctl_value").focus()}function processPopUp(){var t=document.getElementById("frctl_popup");t.classList.add("frctl_hidden"),t.style.left="0px",t.style.top="0px";var a=t.querySelector("#frctl_value").value;""==a||isNaN(a)||(document.getElementsByClassName("frctl_rule-"+ifs_c)[ifs_r+1].innerHTML=a,scanIFS()),t.querySelector("#frctl_value").value=""}function scanIFS(){var t=document.getElementsByClassName("frctl_rule-c");tot_c=6,tot_r=t.length/6,IFSMatrix=[];for(var a=0;a<tot_r;++a)for(var r=0;r<tot_c;++r)IFSMatrix.push(t[tot_c*a+r].innerHTML)}function loadIFS(){for(var t=document.getElementsByClassName("frctl_rule_line"),a=t.length,r=1;r<a;++r)t[1].parentNode.removeChild(t[1]);for(r=0;r<IFSMatrix.length/6;++r){var e=document.createElement("div");e.classList.add("frctl_rule_line");var n='\t\t<span>\n\t\t\t<span class="frctl_rule-r frctl_rule-c frctl_rule_deletable" onclick="getIFSCord(this);getIFSRule(\'r\','+r+')">'+IFSMatrix[6*r+0]+'</span>\n\t\t\t<span class="frctl_rule-s frctl_rule-c frctl_rule_deletable" onclick="getIFSCord(this);getIFSRule(\'s\','+r+')">'+IFSMatrix[6*r+1]+'</span>\n\t\t\t<span class="frctl_rule-t frctl_rule-c frctl_rule_deletable" onclick="getIFSCord(this);getIFSRule(\'t\','+r+')">'+IFSMatrix[6*r+2]+'</span>\n\t\t\t<span class="frctl_rule-p frctl_rule-c frctl_rule_deletable" onclick="getIFSCord(this);getIFSRule(\'p\','+r+')">'+IFSMatrix[6*r+3]+'</span>\n\t\t\t<span class="frctl_rule-e frctl_rule-c frctl_rule_deletable" onclick="getIFSCord(this);getIFSRule(\'e\','+r+')">'+IFSMatrix[6*r+4]+'</span>\n\t\t\t<span class="frctl_rule-f frctl_rule-c frctl_rule_deletable" onclick="getIFSCord(this);getIFSRule(\'f\','+r+')">'+IFSMatrix[6*r+5]+"</span>\n\t\t</span>";e.innerHTML=n,ifs_head_div.appendChild(e)}frctl_rule_count.innerHTML="rules: "+IFSMatrix.length/6}function addRowIFS(){for(var t=0;t<tot_c;++t)IFSMatrix.push("0");loadIFS()}function deleteRowIFS(t){for(var a=[],r=0;r<tot_c*t;++r)a.push(IFSMatrix[r]);for(r+=6;null!=IFSMatrix[r];)a.push(IFSMatrix[r]),++r;IFSMatrix=a,loadIFS()}function deleteLastRowIFS(){for(var t=0;t<6;++t)IFSMatrix.pop();loadIFS()}function resetIFS(){for(var t=0;t<IFSMatrix.length;++t)IFSMatrix[t]="0";loadIFS(),resetCanvas()}function updateIFS(){IFSMatrix=IFSDB[frctl_select.value].param.slice(0),loadIFS()}function revertImg(t){for(var a,r,e,n=0;n<rows/2;++n)for(var o=0;o<cols;++o)r=4*(cols*n+o),e=4*(cols*(rows-n-1)+o),a=t.data[r+0],t.data[r+0]=t.data[e+0],t.data[e+0]=a,a=t.data[r+1],t.data[r+1]=t.data[e+1],t.data[e+1]=a,a=t.data[r+2],t.data[r+2]=t.data[e+2],t.data[e+2]=a,a=t.data[r+3],t.data[r+3]=t.data[e+3],t.data[e+3]=a}function fill(t,a,r,e,n){for(var o=0;o<rows;++o)for(var i=0;i<cols;++i)pk=4*(cols*o+i),t.data[pk+0]=a,t.data[pk+1]=r,t.data[pk+2]=e,t.data[pk+3]=n}function displayImg(t){revertImg(t),context.putImageData(t,0,0)}function mainv1(){var t;fill(oprtnImg=context.createImageData(rows,cols),0,0,0,255);for(var a=0;a<iterations;++a){console.log(a),whiteImg=context.createImageData(rows,cols),tranCImg=context.createImageData(rows,cols),fill(whiteImg,255,255,255,255),fill(tranCImg,0,0,0,0);for(var r=0;r<tot_r;++r)t=tot_c*r,fill(transImg=context.createImageData(rows,cols),0,0,0,0),transformImg(oprtnImg,transImg,IFSMatrix[t+0],IFSMatrix[t+1],IFSMatrix[t+2],IFSMatrix[t+3],IFSMatrix[t+4],IFSMatrix[t+5]),blitImg(transImg,tranCImg);oprtnImg=tranCImg,frctl_itr_count.innerHTML="Iterations: "+(a+1)+"/"+iterations,blitImg(oprtnImg,whiteImg),displayImg(whiteImg)}}function blitImg(t,a){for(var r=0;r<rows;++r)for(var e=0;e<cols;++e)p=4*(cols*r+e),255==t.data[p+3]&&(a.data[p+0]=t.data[p+0],a.data[p+1]=t.data[p+1],a.data[p+2]=t.data[p+2],a.data[p+3]=t.data[p+3])}function transformImg(t,a,r,e,n,o,i,s){for(var l,c,f,I,d=0;d<rows;++d)for(var u=0;u<cols;++u)l=parseInt(r*Math.cos(n*Math.PI/180)*u-e*Math.sin(o*Math.PI/180)*d+i*cols,10),c=parseInt(r*Math.sin(n*Math.PI/180)*u+e*Math.cos(o*Math.PI/180)*d+s*rows,10),l>=0&&l<cols&&c>=0&&c<rows&&(f=4*(d*cols+u),I=4*(c*cols+l),a.data[I+0]=t.data[f+0],a.data[I+1]=t.data[f+1],a.data[I+2]=t.data[f+2],a.data[I+3]=t.data[f+3])}function resetCanvas(){context.putImageData(resetCanvasLayer,0,0)}function resetMatrix(t){for(var a=0;a<rows;++a)for(var r=0;r<cols;++r)t[cols*a+r]=256}function fillMatrix(t,a){for(var r=0;r<rows;++r)for(var e=0;e<cols;++e)t[r*cols+e]=a}function initMatrix(t,a){for(var r=0;r<rows;++r)for(var e=0;e<cols;++e)t.push(a)}function displayMatrixFractal(t){for(var a,r,e,n=context.createImageData(rows,cols),o=0;o<rows;++o)for(var i=0;i<cols;++i)r=4*(a=o*cols+i),256==(e=t[a])?(n.data[r+0]=255,n.data[r+1]=255,n.data[r+2]=255,n.data[r+3]=255):(n.data[r+0]=e,n.data[r+1]=e,n.data[r+2]=e,n.data[r+3]=255);displayImg(n)}function transformMatrix(t,a,r,e,n,o,i,s){for(var l,c,f=0;f<rows;++f)for(var I=0;I<cols;++I)256!=t[f*cols+I]&&(l=parseInt(r*Math.cos(n*Math.PI/180)*I-e*Math.sin(o*Math.PI/180)*f+i*cols,10),c=parseInt(r*Math.sin(n*Math.PI/180)*I+e*Math.cos(o*Math.PI/180)*f+s*rows,10),l>=0&&l<=cols&&c>=0&&c<=rows&&(a[c*cols+l]=t[f*cols+I]))}function mainv2(){scanIFS(),resetCanvas();var t=[],a=[];initMatrix(t,0),initMatrix(a,256);for(var r,e=[t,a],n=0,o=0;o<iterations;++o){for(var i=0;i<tot_r;++i)transformMatrix(e[n],e[1-n],IFSMatrix[(r=6*i)+0],IFSMatrix[r+1],IFSMatrix[r+2],IFSMatrix[r+3],IFSMatrix[r+4],IFSMatrix[r+5]);resetMatrix(e[n]),n=1-n,console.log(o),frctl_itr_count.innerHTML="Iterations: "+(o+1)+"/"+iterations}displayMatrixFractal(e[n])}function mainv3(){frctl_itr_count.innerHTML="Iterations: 0/"+iterations,scanIFS(),resetCanvas();var t=[],a=[];initMatrix(t,0),initMatrix(a,256);var r,e=[t,a],n=0,o=0;frctl_bottom_div.classList.add("frctl_running"),o<iterations&&setTimeout(function t(){for(var a=0;a<tot_r;++a)r=6*a,transformMatrix(e[n],e[1-n],IFSMatrix[r+0],IFSMatrix[r+1],IFSMatrix[r+2],IFSMatrix[r+3],IFSMatrix[r+4],IFSMatrix[r+5]);resetMatrix(e[n]),n=1-n,++o,frctl_itr_count.innerHTML="Iterations: "+o+"/"+iterations,o<iterations?setTimeout(t,500):frctl_bottom_div.classList.remove("frctl_running"),displayMatrixFractal(e[n])},500)}function mainv4(){var t;frctl_itr_count.innerHTML="Iterations: 0/"+iterations,scanIFS();var a=0;frctl_bottom_div.classList.add("frctl_running"),a<iterations&&setTimeout(function r(){for(var e=0;e<tot_r;++e)t=6*e,context.transform(IFSMatrix[t],IFSMatrix[t+2],IFSMatrix[t+3],IFSMatrix[t+1],IFSMatrix[e+4],IFSMatrix[t+5]),context.fillRect(0,0,rows,cols);++a,frctl_itr_count.innerHTML="Iterations: "+a+"/"+iterations,a<iterations&&setTimeout(r,500)},500),frctl_bottom_div.classList.remove("frctl_running")}document.body.onload=function(){frctl_itr_count.innerHTML="Iterations: 0/"+iterations,updateIFS(),tot_c=6,tot_r=3};